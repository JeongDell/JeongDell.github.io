---
layout: post
title:  "실무로 통하는 인과추론 with 파이썬 2장"
published: true
date:   2024-09-11 05:50:00
categories: CI(Causal Inference)
permalink: /CI/2
---

# 2. 무작위 실험 및 기초 통계 리뷰

- 우리가 원하는 것은 잠재적 결고가 처치와 독립적안 것
- 독립성 가정은 실험군과 대조군이 비교 가능하게 만듦

- 무작위로 처치를 배정하면 실험군과 대조군의 기댓값은 거의 비교 가능해지고, 두 그룹간의 유일한 차이는 처치 밖에 없으므로, 두 그룹의 결과 차이는 해당 처치에 따른 것으로 볼 수 있음
   - 대표적인 방법: 랜덤화
- RCT: 무작위 통계 실험(A/B 테스트)
   - RCT는 인과효과를 파악하는 가장 신뢰할 수 있고, 간단한 방법임,
   - 하지만 많은 시간과 비용이 들거나 비윤리적인 경우가 발생할 수 있음
   - 따라서 RCT를 벤치마킹하여 효과적인 인과추론을 해야 함

## 2.1 가장 위험한 수식

<b>드무아브르의 공식 </b>   
![image](https://github.com/user-attachments/assets/145efe38-6839-4c9c-9316-bc1519931b2c)

>- SE: 평균의 표준오차
>- sigma: 표준편차
>- n: 표본의 크기

- 위 공식은 표본의 크기가 커질수록 표준편차가 작아지는 것을 보여준다
  - 즉 표본의 크기가 커질수록 불확실성이 떨어진다

## 2.2 추정값의 표준오차

![image](https://github.com/user-attachments/assets/50eeb102-0fb8-4571-a0bb-1e9958fe32fd)

- 표준편차를 구하는 공식은 위와 같다

- 판다스에서는 std를 사용하여 구할 수 있다

- .sem(): 표준 오차를 계산


## 2.3 신뢰구간

- 실험의 실제 평균을 포함한다고 추측하는 구간
- 추정값에 대해 불확실성을 나타내는 방법

ex) 95%의 신뢰구간: 전체 구간 중 95% 구간안에 실험의 실페 평균이 포함되어 있음
   - 95% 확률로 실제 평균을 포함하는 것이 아님에 주의 
   - 실제 평균을 포함할 경우 포함 확률은 100%, 그렇지 않다면 0%


## 2.4 가설검정

- 두 그룹간의 평균 차이가 0(혹은 다른 특정값)과 통게적으로 유의한 차이가 있는가? 라는 질문을 다룸

- 두 독립 정규분포의 합이나 차 역시 정규분포라는 가정이 필요

- 그 결과로 생성된 분포의 평균은 원래 두 분포 평균의 합이나 차이가 되고 분산은 항상 두 분산의 합으로 계산

![image](https://github.com/user-attachments/assets/59c6c2a5-f0b3-433b-9976-7e72799ee173)

### 2.4.1 귀무가설

- 일반적으로 H0로 표기

- 한 사건에 대해 '만약 귀무가설이 참이라면 이런 차이를 실제로 관측할 수 있을까?'를 데이터에서 확인 
- 이후 신뢰구간에서 그 차이가 발생했는지 아닌지 여부로 귀무가설을 기각할지 판단

![image](https://github.com/user-attachments/assets/ffbefaa1-ce71-4d51-925a-abcc5349c55e)

- 위 그림에서는 0이 귀무가설의 값이지만, 신뢰구간 밖에 있으므로 귀무가설을 기각


- 유의수준(a)
   - 귀무가설이 참인데도 이를 기각하는 1종 오류를 범할 확률
   - 데이터를 수집하거나 분석하기 전에 설정
   - 특정 유의 수준을 목표로 한다면, 분석 과정 중에 추정값을 중심으로 1-a의 신뢰구산을 구성해야 함


### 2.4.2 검정 통계량

- 값이 클수록 귀무가설을 기각

>t- 통계량

![image](https://github.com/user-attachments/assets/1039bb34-1d19-46fd-8bf6-d5d67f42f430)
      
- 신뢰구간을 형성하는 분포를 정규화함으로써 정의 

- H0: 귀무가설에서 정의한 값

- 분자: 관측한 평균 차이와 귀무가설 사이에 대한 차이
  -  귀무가설이 참이라면 분자의 기댓값 = 0 

- 분모: 단순한 표준 오차, 통계량의 분산이 1이 되도록 정규화
  - 이 정규화를 통해 귀무가설이 참인 경우 t는 표준 정규분포를 따름
     - 귀무가설 하에 t는 0이 중심이기 때문에 1.96보다 크거나 -1.96보다 작은 값은 매우 드물게 나타남
     - 즉 이런 값이 나타나면 귀무가설을 기각할 수 있음

## 2.5 p 값

- p 값: 귀무가설이 참이라고 가정할 때 관측된 결과보다 더 극단적인 결과가 실제로 관측될 확률
   - 즉 귀무가설이 참일 경우 극단적인 데이터가 나타날 확률

![image](https://github.com/user-attachments/assets/edd6fd78-c295-4bb6-88c6-bcdc1ff0664a)

- 단측 귀무가설(차이가 x보다 크다 또는 차이가 x보다 작다)에서 p값을 구하려면 표준정규분포에서 검정통계량 전에 해당하는 영역의 넓이를 계산하면 됨

- 양측 귀무가설(차이가 x이다)에서는 해당 결과에 2를 곱하면 됨

- p는 95%나 99%와 같은 신뢰 구간을 정하지 않아도 된다는 장점이 존재


## 2.6 검정력

- 검정력: 귀무가설을 올바르게 기각할 확률

- 실험에 필요한 표본 크기를 파악할 때, 제대로 실행하지 않은 실험에서 문제를 발견할 때 유용

- 검정력(1-β)은 귀무가설이 거짓인 경우 이를 올바르게 기각할 확률

> 95% 신뢰구간이란, 실험을 통해 얻은 신뢰구간 중 95%가 추정하고자 하는 매개변수의 실젯값을 포함함을 의미, 즉 나머지 5%에서 실젯값을 포함하지 않음을 의미
>> 5% 확률로 귀무가설을 잘못 기각하게 됨


## 2.7 표본 크기 계산



